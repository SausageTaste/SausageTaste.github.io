---
layout: post
title:  "RTX란 무엇인가 2편 - 하이브리드 렌더링 파이프라인"
comments: true
use_math: true
---

*이미지를 클릭하시면 이미지 출처 페이지로 이동합니다. 클릭되지 않는 이미지의 저작권은 제게 있습니다.*  
*Click image to go to the page where I found it. Non clickable images are created by me.*

<br>

Nvidia가 홍보하는 RTX의 주요 개선 분야는 다음과 같습니다.

* 좀 더 사실적인 반사
* 요상한 버그(artifect)가 없는 그림자
* 좀 더 정확한 엠비언트 오클루전(ambient occlusion)
* 대박사건! 실시간 글로벌 일루미네이션

넷 다 복잡한 주제이고 쉽게 설명하는 것이 상당히 어렵습니다.
이번 글에서는 맛보기로 사실적인 반사에 대해서만 좀 더 언급하고 넘어가도록 하겠습니다.


## 1. 좀 더 사실적인 반사

레이 트레이싱이 “Make 반사 great again”을 아주 훌륭하게 수행했다는 건 제 눈으로 똑똑히 봤습니다.
그런데 레이 트레이싱을 못 쓰는 게임에서는 그동안 반사를 어떻게 구현했을까요?
여기에 세 가지가 있습니다.
평면 반사, 큐브맵 반사, 화면공간 반사가 있습니다.
추후 별개의 포스트에서 이 세 반사 구현방식의 특징을 설명해 드리도록 하고, 여기선 간략히 설명 드릴게요.

**평면 반사 (Planar reflection)**는 하프라이프2에서 물 반사를 구현하는데 사용되었는데요.
본질적으로 화면을 두 번 렌더링 하는 것이라서 성능을 반토막 내버립니다.
그리고 이름을 보면 알 수 있듯, 평면이 아닌 물체의 반사를 구현하는 데에는 사용할 수 없습니다.

**큐브맵 반사 (Cubemap reflection)**는 현대 대부분의 게임에서 총이나 사람처럼 복잡하면서 비교적 작은 물체 표면의 반사를 구현하는 데 사용됩니다.
반사된 이미지가 실제 위치와 맞지 않는 문제가 있어 플레이어가 위화감을 느낄 수 있습니다.
총기 표면에 구름이 반사되는데 위치 좀 어긋난다고 눈치채는 사람 없겠지만, 매끈한 타일 바닥에 반사된 상은 조금만 어긋나도 몰입감을 해칠 정도가 되지요.

**화면공간 반사 (Screen space reflection)**는 여러분의 모니터에 그려진 정보를 바탕으로 3차원 공간으로 해석하여, 그 공간에서 반사되는 상을 찾는 기술입니다.
굉장히 빠르면서 아름다운 이미지를 만들 수 있지만, 화면 밖으로 나가버린 물체는 반사되지 못 한다는 큰 문제가 있습니다.
디바의 속바지는 화면 안에 포착되지 않았기 때문에 반사상에도 없습니다.

![screen_space_reflection_dva](/assets/images/graphics_01/screen_space_reflection_dva.jpg)

위 세 개의 반사 구현 방식들은 저마다의 한계가 있습니다.
그런데 레이 트레이싱은 눈속임이 아니라 정말 빛의 행동을 흉내내기 때문에 아주 정확한 반사상을 만들 수 있습니다.
물론 고품질의 반사상을 만드는 건 더 오래 걸리지만, 게이머의 눈을 만족시키는 정도라면 엄청 고품질까지는 필요하지 않겠지요.


# 2. 하이브리드!

배틀필드5처럼 RTX를 지원하는 게임들은 사실 온전히 레이 트레이싱만 사용하는 것은 아닙니다.
장면을 원래 게임이 렌더링 하듯 일반적인 방법으로(레스터라이저) 그린 다음, 그 위에 레이 트레이싱 이미지를 첨가하는 방식입니다.
건물, 풀, 총, 하늘, 구름은 일반적으로 그린 다음, 바닥에 물 웅덩이에서만 레이 트레이싱을 하는 식으로요.

![eevee_vs_cycle](/assets/images/graphics_01/eevee_vs_cycle.jpg)
<!-- 배틀필드5의 RTX on/off 비교 사진으로 교체 -->

레스터라이저도 엄청나게 발전했습니다.
위 이미지는 블렌더의 Eevee와 Cycle 렌더러로 각각 렌더링한 것입니다.
우측은 온전히 레이 트레이싱만 사용해 렌더링한 결과물인데, 좌측의 레스터라이저의 결과물과 비교했을 때 큰 차이가 안 느껴지죠?

위에서 본 것처럼, 반사처럼 같은 일부에서만 레스터라이저가 눈에 띄게 부실합니다.
그러니 그런 부분을 선별하여 그곳에서만 레이 트레이싱을 사용한다면 최소한의 비용으로 최대 효율을 뽑아낼 수 있게 되는 것입니다.
이렇게 레스터라이저와 레이 트레이싱의 장점만 쏙쏙 뽑아서 렌더링을 하는 것을 **하이브리드 렌더링 파이브라인 Hybrid Rendering Pipeline**이라고 합니다.

[![hybrid_rendering_pipeline](/assets/images/graphics_01/hybrid_rendering_pipeline.png)](https://media.contentapi.ea.com/content/dam/ea/seed/presentations/pica-pica-and-nv-turing-release.pdf)

레스터라이저는 상당히 복잡하고 난해한 개념입니다.
저는 현재 이것에 대해 설명하는 글을 계획하고 있으며, 그 분량은 적어도 포스트 10개는 넘을 것으로 예상됩니다.
오래 걸릴 것 같으니 기대는 하지 말아 주세요. ㅜㅜ
만약 스스로 이것에 대해 공부해 보고 싶으신 분들은 OpenGL에 대해 공부해 보시기 바랍니다.

이 다음은 레이 트레이싱에 대해 설명해 보겠습니다.
