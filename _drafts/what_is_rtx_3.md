---
layout: post
title:  "RTX란 무엇인가 3편 - GeForce RTX 튜링 아키텍처"
comments: true
use_math: false
---

*이미지를 클릭하시면 이미지 출처 페이지로 이동합니다. 클릭되지 않는 이미지의 저작권은 제게 있습니다.*
<br>
*Click image to go to the page where I found it. Non clickable images are created by me.*

<br>

지금까지 레이트레이싱의 원리에 대해 간단하게 알아봤습니다.
복잡한 내용이 많아 잘 기억에 안 남는 부분이 많을 것입니다.
내용을 확실하게 이해하려면 같은 내용을 두번 세번 반복해서 읽어야 할 수도 있습니다.

하지만 이번 글의 내용을 이해하려는데 이전 두 글의 내용을 완벽하게 암기하고 있을 필요는 없습니다.
이 두 가지만 떠올려 주세요.

* 레이트레이싱은 기본적으로 선분과 삼각형 사이의 접점을 찾는 수학적 과정이다.
* 공간에는 삼각형이 너무 많기 때문에 상자 도형을 이용해 접점 존재 가능성이 없는 삼각형을 추려낸다.

이 두 개념이 중요한 이유는 RTX 그래픽카드가 수행하는 일이 정확하게 이것이기 때문입니다.
그럼 지금부터 RTX 그래픽카드의 내부에 대해 자세히 알아보겠습니다.


# RTX GPU 

우선 용어부터 확실히 정리하겠습니다.
일반인에게는 그래픽카드가 더 익숙한 이름이겠지만, 사실 그래픽카드는 여러가지 요소가 하나의 제품으로 합쳐진 복합체입니다.
정리하자면 그래픽카드 자신의 CPU와 RAM을 별개로 갖고 있는 셈이 됩니다.

* GPU : 연산을 수행하는 유닛으로 CPU와 같은 포지션
* VRAM : AAA 게임의 그래픽 설정에 자주 보이는 것으로, GPU가 연산을 수행하는 데 필요한 정보를 저장하는 곳으로 RAM과 같은 포지션

이번 글에서는 GPU에 집중하려고 합니다.
GPU가 VRAM과 빠르게 통신하는 기술, 수천 개의 GPU 코어가 하나의 VRAM과 통신하면서 순서가 꼬이지 않게 하는 기술 등의 복잡한 내용들은 범위 밖의 내용입니다.
저희는 순수하게 GPU 안에만 들어있는 것들에 대해 알아볼 것입니다.

지금부터 RTX 그래픽카드라 하지 않고 RTX GPU라는 용어를 주로 사용하겠습니다.
그리고 RTX 이전의 것, 우리가 오랫동안 사용해 오던 것들은 GTX GPU라고 부르겠습니다.
정식 명칭은 아닙니다.
맥스웰 아키텍처, 튜링 아키텍처라는 공식 용어가 있긴 합니다만.
별로 안 익숙하잖아요?
그냥 RTX랑 GTX라고 부르는 게 더 쉬울 거라 생각했습니다. ^^


# GPU가 하는 일

앞서 GPU가 CPU와 같은 포지션이라고 설명 드렸습니다.
구체적으로 말하자면 GPU는 실수(real number, 實數)의 덧셈, 곱셈, 제곱근 등의 연산을 매우 빠르게 수행합니다.
그런데 사실 일반인 입장에서는 이 이상 자세히 이해하기는 쉽지 않습니다.

어쨌든 저희의 목적은 RTX에 대해 이해하기잖아요?
그러니 GPU에 대해 자세히 이해할 필요는 없습니다.
대신 RTX 이전의 GPU와 RTX GPU 사이의 차이점만 알아보면 될 거라고 생각합니다.

![](https://www.gamersnexus.net/images/media/2018/gpus/2080-ti/arch/sm-architecture-block-diagram.jpg)

위 그림이 RTX의 코어 하나의 구조입니다.
보통 GPU 안에는 이런 코어가 수천 개가 있습니다.
하나하나 뜯어봐도 뭐가 뭔지 감도 안 옵니다.

저희는 이 그림에 나온 것들 중 일부만 알아도 됩니다만.
아무래도 RTX에 새로 생긴 것이 얼마나 대단한 것인지 이해하려면, 비교할 대상이 필요하지요?


# 부동소수점 연산

그림에서 초록색 상자 안에 흰 글자로 FP32라고 적혀 있는 곳이 보이시나요?
이것은 floating point 32 bit를 의미하는데요.
프로그래밍에 대해 아시는 분이라면 float 타입의 숫자를 의미한다는 걸 바로 눈치채셨을 겁니다.
`float`이 뭔지 잘 모르신다면 그냥 **실수(real number, 實數)**라고만 알고 계시면 되겠습니다.

실수의 연산은 컴퓨터 그래픽스에서 가장 중요한 요소입니다.

저번 글에서 보셨들이 모든 3차원 물체는 숫자로 표현됩니다.
물체를 공간 안에서 이리저리 이동하고 애니메이션을 적용하는 것은 행렬곱을 사용하는데, 이것도 내부를 보면 숫자의 덧셈과 곱셈이죠.
물체의 표면에 빛 효과를 적용하는 것은 벡터의 내적, 제곱근, 그리고 덧셈과 곱셈으로 이루어져 있습니다.

그림자는 물체의 위치 정보를 행렬곱을 적용하여 텍스처에 저장, 나중에 이를 역행렬로 되찾아서 값의 대소 비교를 통해 구현됩니다.
역시나 대부분 실수의 연산이지요.

반사 효과도 마찬가지입니다.
물체의 위치 정보와 색깔 정보를 행렬곱을 적용해 텍스처로 저장한 뒤, 벡터 연산을 통해 올바른 반사상의 위치를 찾아냅니다.

저도 일개 프로그래머에 불과해서 이 FP32 장치가 구체적으로 어떻게 작동하는지는 모릅니다.
일단 대학 컴퓨터시스템 시간에 배운 내용을 토대로 생각해 봤습니다.
FP32 안에는 몇 개의 논리회로가 들어 있습니다.
실수를 32 비트 `float`의 형태로 이 논리회로에 입력하고, 덧셈을 원하는지 곱셈은 원하는지를 전기신호로 입력해 주면 그 결과값을 돌려주는 방식일 것입니다.
CPU 안에 들어 있는 FPU과 비슷하지 않을까 생각합니다.

> 추후 자료 조사를 하여 내용을 추가할 예정

실수의 연산은 그래픽 연산 과정의 90% 이상을 차지합니다
GTX나 RTX 둘 다 가장 중요한 전략은 이 실수 연산을 담당하는 하드웨어를 수천 개 때려박아 같은 시간 안에 연산량을 늘리는 것입니다.
레이트레이싱도 실수의 연산을 굉장히 많이 하기 때문에, 이 부분은 GTX와 RTX 사이의 차이가 거의 없는 부분이 되겠습니다.
(물론 더 최근에 나온 RTX GPU에 장착된 FP32가 좀 더 성능이 좋겠지만요.)


# RT Core

그럼 이제부터 본격적으로 RTX에만 있는 것들에 대해 이야기해 보도록 하겠습니다.

RT라는 이름만 봐도 딱 눈치가 옵니다.
이것이 바로 레이트레이싱 관련 연산을 수행하는 하드웨어 장치입니다.
현대의 게임에서 볼 수 있는 아름다운 반사, 실시간 글로벌 일루미네이션의 마술은 바로 여기서 일어나는 것이지요.

RT 코어는 두 가지 종류의 계산을 합니다.
