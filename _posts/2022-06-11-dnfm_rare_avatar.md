---
layout: post
title:  "던파M 레압 맞추는 기대 비용은 얼마일까?"
use_math: true
comments: true
---

# 결론

결론부터 말씀드리겠습니다.

깔맞춤을 고려하지 않고, 바인드큐브와 아바타를 상점에서 조달하는 경우, 한 부위당 평균 **2만 3천 원**이 소모됩니다.
8개 부위를 깔맞춤 없이 다 맞춘다면 **18만 4천 원**이 들 거라고 기대할 수 있습니다.

상점 대신 경매장에서 바인드큐브를 조달한다면, 최저가 13700 테라 기준, 한 부위당 평균 **24만 8500 테라**가 소모됩니다.
8개 부위를 깔맞춤 없이 다 맞춘다면 **198만 8천 테라**가 들 거라고 기대할 수 있습니다.

# 수학

우선 변수부터 설정하겠습니다.
언커먼 아바타의 가격을 $A$로, 바인드큐브의 가격을 $B$로 둡니다.
이때 가격의 단위는 원화를 쓰든 테라를 쓰든 상관 없으나, $A$와 $B$의 단위는 같아야 합니다.
여기서는 인게임 상점 기준을 적용해서 $A = ₩3000$, $B = ₩1000$으로 두겠습니다.
아바타는 30,000 테라이지만, 세라로 환산하고 원화로 환산하여 3,000으로 두었습니다.

아바타 합성을 했을 때 레압이 나올 확률은 $r$로 정합니다.
인게임 정보에 따르면 이 확률은 20%이므로 $r = 0.2$가 됩니다.

### 비용 함수

이제 함수를 정의합니다.
n번째 시도에서 레압 뽑기에 성공했을 때 투여된 총 비용을 $T_n$으로 정의하겠습니다.
예를 들어 실패 없이 한 번에 레압 뽑기에 성공한 경우, 아바타 2개 값이랑 바인드큐브 하나 값이 들겠지요.
이를 식으로 나타내면 다음과 같습니다.

$$ T_1 = 2A + B $$

두 번째에 성공한 경우는 다음과 같습니다.

$$ T_2 = A + B + T_1 $$

처음에 실패하여 소모된 비용에 더해서, 바인드큐브와 재료 아바타 하나씩을 더 사야 하므로 $A + B$가 더해집니다.
던파M의 레압 뽑기 방식은, 언커먼 아바타 두 개를 합성해서 성공하면 레압이 튀어나오고 실패하면 언커먼 아바타가 튀어나옵니다.
이걸 그대로 다시 재료로 쓰는 거죠.

$$ T_3 = A + B + T_2 = 2(A + B) + T_1 $$

$$ T_4 = A + B + T_3 = 3(A + B) + T_1 $$

$$ T_5 = A + B + T_4 = 4(A + B) + T_1 $$

$$ ... $$

$$ T_n = A + B + T_{n - 1} = (n - 1)(A + B) + T_1 $$

패턴을 발견하셨나요?
이제 이것을 정리하면 완성입니다.

$$ T_n = (A + B)n + A $$

아까 위에서 A와 B의 값을 결정했기 때문에

$$ T_n = (3000 + 1000)n + 3000 = 4000n + 3000 $$

이렇게 정리가 되기는 합니다만.
좀 더 일반화된 식을 찾기 위해서 계속 변수 A와 B를 쓰겠습니다.
바인드큐브를 경매장에서 사는 분들은 변수 B의 값만 바꿔서 계산할 수 있도록 배려하는 차원에서 말이죠.

### 확률 함수

이번에 정의할 함수는 $P_n$입니다.
n번째 합성에서 레압이 당첨될 확률을 말합니다.
P_1의 경우, 즉 한 번에 레압이 당첨될 확률은 당연히 20%겠죠?

$$ P_1 = r $$

2번째 합성에서 성공하려면, 첫 번째에서 실패하고 두 번째에 성공해야 합니다.

$$ P_2 = (1-r)r $$

이제 패턴을 찾아 봅시다.

$$ P_3 = (1-r)^2 r $$

$$ P_4 = (1-r)^3 r $$

$$ P_5 = (1-r)^4 r $$

$$ ... $$

$$ P_n = (1-r)^{n-1} r $$

이번에도 역시 위해서 $r$의 값을 정했기 때문에 $P_n = 0.8^{n-1}0.2$로 쓸 수는 있지만, 일반화된 형태를 유지하겠습니다.

이것이 올바른 확률 함수가 맞나 확인해 볼까요?
한 번만에 뽑을 확률, 2번째에 뽑을 확률, 3번째에… 9999천 9999번째에 뽑을 확률… 등등 다 더했을 때 1이 나와야만 합니다.
즉

$$ \lim_{n \to \infty} (P_1 + P_2 + P_3 + ... + P_{9999 9999} + ... + P_n) = \sum_{n=1}^{\infty} P_n = 1 $$

이 등식이 성립해야만 합니다.

위키백과에서 찾을 수 있는 [이 공식](https://en.wikipedia.org/wiki/Summation?oldformat=true#Summation_index_in_exponents)을 이용하면 이 식을 쉽게 풀어헤칠 수 있습니다.

$$
\begin{split}
\sum_{n=0}^{k-1} a^n & = \frac{1-a^k}{1-a} \\
\sum_{n=1}^{k} a^{n-1}  & = \\
\end{split}
$$

이 공식에서 $k = \infty$, 그리고 $a = (1-r)$로 두면 풀 수 있겠군요.

$$
\begin{split}
\sum_{n=1}^{\infty} P_n & = \sum_{n=1}^{\infty} (1-r)^{n-1} r \\
                        & = r \sum_{n=1}^{\infty} (1-r)^{n-1} \\
                        & = r \frac{1-(1-r)^{\infty}}{1-(1-r)} \\
                        & = r \frac{1}{1-1+r} \\
                        & = \frac{r}{r} = 1 \\
\end{split}
$$

우리가 만든 확률 함수 $P$가 올바르게 작동한다는 것을 증명했습니다.

Q.E.D.

아디오스.

![dnf_ranger_adios](/assets/images/misc_01/dnf_ranger_adios.jpg)

### 결합

이제 레압 한 부위를 뽑기 위해 필요할 거라 예상되는 비용을 계산할 차례입니다.
말로 이러쿵 저러쿵 하는 것보다는 바로 식을 보여드리겠습니다.

$$ \lim_{n \to \infty} (P_1T_1 + P_2T_2 + P_3T_3 + P_4T_4 + ... + P_nT_n) $$

수학적으로 말하자면 백만 번 시도해도 레압이 안 나올 확률이 0이 아니라서, 무한번까지 싹다 더해줄 겁니다.
참고로 백만 번째에 나올 확률은

$$ P_{1,000,000} = (1-r)^{1,000,000}r = 1.94098 \times 10^{-96911} $$

가 되는데… 아무튼 0은 아니네요.

$$ \sum_{n = 1}^{\infty} P_nT_n = \sum_{n = 1}^{\infty} [(A+B)n + A](1-r)^{n-1}r $$

이걸 계산해야 합니다.
여기서 대가리가 슬슬 아파오기 시작합니다만.
우리가 명심해야 할 것은, 이것은 수능 공부가 아니라는 사실입니다.
그렇죠, 컴퓨터를 사용하면 되죠!
[WolframAlpha](https://www.wolframalpha.com/input?i=sum+%28%28A%2BB%29*n+%2B+A%29%281-r%29%5E%28n-1%29*r%2C+n%3D1+to+infinity)라는 공대생들의 영원한 친구를 사용하면 쉽게 해결할 수 있습니다.

![wolframalpha_dnfm_sum](/assets/images/misc_01/wolframalpha_dnfm_sum.png)

편안하네요.
울프람 형님이 보여준 것을 그대로 써보면 다음과 같죠.

$$\sum_{n = 1}^{\infty} P_nT_n = \frac{-Ar^2 + A - Br + B}{(1-r)r} $$

$$ when \ \left| \frac{-rA + A + B - Br}{A + B} \right| < 1 $$

근데 가만히 보면 저 식도 더 정리를 할 여지가 있어 보입니다.
그래서 바로 종이를 꺼내서 계산해 봤습니다.
그러면 다음과 같이 간단해집니다.

$$\sum_{n = 1}^{\infty} P_nT_n = \frac{A(r+1) + B}{r} $$

$$ when \ \left| 1-r \right| < 1 $$

$r$은 확률이므로 당연히 $0 < r < 1$을 만족할 것이므로 저 조건부는 신경쓸 필요가 없습니다.
그리고 위의 식에 있는 $A$, $B$, $r$ 각각에 아까 정했던 값들을 집어넣으면

$$\frac{3000(0.2+1) + 1000}{0.2} = 23000 $$

이렇게 해서 2만 3천 원이라는 값이 나왔고 제일 위에서 말했던 결론이 나오게 된 것입니다.

연습삼아 바인드큐브를 경매장에서 구입하는 경우도 알아볼까요?
지금 보니 바인드큐브 값이 최저가 13,700 테라로 거래되고 있군요.
그러니 $B = 13700$입니다.

아까 $A$와 $B$의 단위가 같아야 한다고 했죠?
언커먼 아바타의 가격은 30,000 테라이므로 $A = 30000$입니다.
그렇다면 결론은

$$\frac{30000(0.2+1) +  13700}{0.2} = 248500 $$

24만 8500 테라가 드는군요.
